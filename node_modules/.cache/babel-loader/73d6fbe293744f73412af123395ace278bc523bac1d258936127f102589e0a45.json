{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/chica/OneDrive/Documents/GitHub/meet/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/chica/OneDrive/Documents/GitHub/meet/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"C:/Users/chica/OneDrive/Documents/GitHub/meet/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";// src/api.js\nimport mockData from'./mock-data';// extract location data from list of events\nexport var extractLocations=function extractLocations(events){var extractedLocations=events.map(function(event){return event.location;});var locations=_toConsumableArray(new Set(extractedLocations));return locations;};// check for valid token\nvar checkToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(accessToken){var response,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=\".concat(accessToken));case 2:response=_context.sent;_context.next=5;return response.json();case 5:result=_context.sent;return _context.abrupt(\"return\",result);case 7:case\"end\":return _context.stop();}},_callee);}));return function checkToken(_x){return _ref.apply(this,arguments);};}();// if not token is found a new token is fetched\nvar getToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(code){var encodeCode,response,_yield$response$json,access_token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:encodeCode=encodeURIComponent(code);_context2.next=3;return fetch('https://hkb3ik7soh.execute-api.us-east-1.amazonaws.com/dev/api/token'+'/'+encodeCode);case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:_yield$response$json=_context2.sent;access_token=_yield$response$json.access_token;access_token&&localStorage.setItem('access_token',access_token);return _context2.abrupt(\"return\",access_token);case 10:case\"end\":return _context2.stop();}},_callee2);}));return function getToken(_x2){return _ref2.apply(this,arguments);};}();// remove the code from URL once finished\nvar removeQuery=function removeQuery(){var newurl;if(window.history.pushState&&window.location.pathname){newurl=window.location.protocol+'//'+window.location.host+window.location.pathname;window.history.pushState('','',newurl);}else{newurl=window.location.protocol+'//'+window.location.host;window.history.pushState('','',newurl);}};// fetch the list of all events \nexport var getEvents=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var token,url,response,result;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(!window.location.href.startsWith('http://localhost')){_context3.next=2;break;}return _context3.abrupt(\"return\",mockData);case 2:_context3.next=4;return getAccessToken();case 4:token=_context3.sent;if(!token){_context3.next=19;break;}removeQuery();url='https://hkb3ik7soh.execute-api.us-east-1.amazonaws.com/dev/api/get-events'+'/'+token;_context3.next=10;return fetch(url);case 10:response=_context3.sent;_context3.next=13;return response.json();case 13:result=_context3.sent;if(!result){_context3.next=18;break;}return _context3.abrupt(\"return\",result.events);case 18:return _context3.abrupt(\"return\",null);case 19:case\"end\":return _context3.stop();}},_callee3);}));return function getEvents(){return _ref3.apply(this,arguments);};}();export var getAccessToken=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var accessToken,tokenCheck,searchParams,code,response,result,authUrl;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:accessToken=localStorage.getItem('access_token');_context4.t0=accessToken;if(!_context4.t0){_context4.next=6;break;}_context4.next=5;return checkToken(accessToken);case 5:_context4.t0=_context4.sent;case 6:tokenCheck=_context4.t0;if(!(!accessToken||tokenCheck.error)){_context4.next=24;break;}_context4.next=10;return localStorage.removeItem('access_token');case 10:searchParams=new URLSearchParams(window.location.search);_context4.next=13;return searchParams.get('code');case 13:code=_context4.sent;if(code){_context4.next=23;break;}_context4.next=17;return fetch('https://hkb3ik7soh.execute-api.us-east-1.amazonaws.com/dev/api/get-auth-url');case 17:response=_context4.sent;_context4.next=20;return response.json();case 20:result=_context4.sent;authUrl=result.authUrl;return _context4.abrupt(\"return\",window.location.href=authUrl);case 23:return _context4.abrupt(\"return\",code&&getToken(code));case 24:return _context4.abrupt(\"return\",accessToken);case 25:case\"end\":return _context4.stop();}},_callee4);}));return function getAccessToken(){return _ref4.apply(this,arguments);};}();","map":{"version":3,"names":["mockData","extractLocations","events","extractedLocations","map","event","location","locations","_toConsumableArray","Set","checkToken","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","accessToken","response","result","wrap","_callee$","_context","prev","next","fetch","concat","sent","json","abrupt","stop","_x","apply","arguments","getToken","_ref2","_callee2","code","encodeCode","_yield$response$json","access_token","_callee2$","_context2","encodeURIComponent","localStorage","setItem","_x2","removeQuery","newurl","window","history","pushState","pathname","protocol","host","getEvents","_ref3","_callee3","token","url","_callee3$","_context3","href","startsWith","getAccessToken","_ref4","_callee4","tokenCheck","searchParams","authUrl","_callee4$","_context4","getItem","t0","error","removeItem","URLSearchParams","search","get"],"sources":["C:/Users/chica/OneDrive/Documents/GitHub/meet/src/api.js"],"sourcesContent":["// src/api.js\r\n\r\nimport mockData from './mock-data';\r\n\r\n// extract location data from list of events\r\nexport const extractLocations = (events) => {\r\n  const extractedLocations = events.map((event) => event.location);\r\n  const locations = [...new Set(extractedLocations)];\r\n  return locations;\r\n};\r\n\r\n// check for valid token\r\nconst checkToken = async (accessToken) => {\r\n  const response = await fetch(\r\n    `https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=${accessToken}`\r\n  );\r\n  const result = await response.json();\r\n  return result;\r\n};\r\n\r\n// if not token is found a new token is fetched\r\nconst getToken = async (code) => {\r\n  const encodeCode = encodeURIComponent(code);\r\n  const response = await fetch(\r\n    'https://hkb3ik7soh.execute-api.us-east-1.amazonaws.com/dev/api/token' + '/' + encodeCode\r\n  );\r\n  const { access_token } = await response.json();\r\n  access_token && localStorage.setItem('access_token', access_token);\r\n\r\n  return access_token;\r\n};\r\n\r\n// remove the code from URL once finished\r\nconst removeQuery = () => {\r\n  let newurl;\r\n  if(window.history.pushState && window.location.pathname) {\r\n    newurl = window.location.protocol + '//' + \r\n      window.location.host +\r\n      window.location.pathname;\r\n    window.history.pushState('', '', newurl);\r\n  } else {\r\n    newurl = window.location.protocol + '//' + window.location.host;\r\n    window.history.pushState('', '', newurl);\r\n  }\r\n};\r\n\r\n// fetch the list of all events \r\nexport const getEvents = async () => {\r\n  if(window.location.href.startsWith('http://localhost')) {\r\n    return mockData;\r\n  }\r\n\r\n  const token  = await getAccessToken();\r\n\r\n  if (token) {\r\n    removeQuery();\r\n    const url = 'https://hkb3ik7soh.execute-api.us-east-1.amazonaws.com/dev/api/get-events' + '/' + token;\r\n    const response = await fetch(url);\r\n    const result = await response.json();\r\n    if (result) {\r\n      return result.events;\r\n    } else return null;\r\n  }\r\n};\r\n\r\nexport const getAccessToken = async () => {\r\n  const accessToken = localStorage.getItem('access_token');\r\n  const tokenCheck = accessToken && (await checkToken(accessToken));\r\n\r\n  if (!accessToken || tokenCheck.error) {\r\n    await localStorage.removeItem('access_token');\r\n    const searchParams = new URLSearchParams(window.location.search);\r\n    const code = await searchParams.get('code');\r\n    if (!code) {\r\n      const response = await fetch(\r\n        'https://hkb3ik7soh.execute-api.us-east-1.amazonaws.com/dev/api/get-auth-url'\r\n      );\r\n      const result = await response.json();\r\n      const { authUrl } = result;\r\n      return(window.location.href = authUrl); \r\n    }\r\n    return code && getToken(code);\r\n  }\r\n  return accessToken;\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}